# :dollar: Stonehenge

[The stonehenge](https://static.turbosquid.com/Preview/2019/02/13__15_50_21/Lowpoly_Stonehenge_05.jpg720E3DA3-2A5D-4E28-A953-C096C27DB0D1Large.jpg)

[![made-with-Go](https://img.shields.io/badge/Made%20with-Go-1f425f.svg)](http://golang.org)

## ğŸ“– Overview

Stonehenge is a payment service that allows you to send and receive money. It stores your budget and your transfer history,
so that you can keep track where your money is going to or coming from. In this service, every account created starts with
an initial budget.

### Service actions
* creates a new account for applicants
* keeps track of transfers history
* transfers money between accounts
* lists available accounts

## âš™ï¸ Operational

### How to build and run

#### Building local (needs Go)

```bash
$ make compile
```

#### Running local with Docker

```bash
$ make setup-dev
```

Check configurations at `deploy/development/docker-compose.yml`, so you can learn more about the addresses where the
deployed services can be found.

### How to test and run coverage

```bash
$ make test
$ make test-coverage
```

## ğŸ§© Project Overview

### Design

Based on [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html).

```
.
â”œâ”€â”€ app
â”‚      â”œâ”€â”€ domain
â”‚      â”‚        â”œâ”€â”€ entities # domain entities 
â”‚      â”‚        â”œâ”€â”€ types # value objects (https://martinfowler.com/bliki/ValueObject.html)
â”‚      â”‚        â””â”€â”€ usecases # domain usecases (https://martinfowler.com/bliki/UseCase.html)
â”‚      â”œâ”€â”€ gateways
â”‚      â”‚         â”œâ”€â”€ db # database infrastructure layer
â”‚      â”‚         â”œâ”€â”€ events # event dispatching infrastructure
â”‚      â”‚         â”œâ”€â”€ http # HTTP API infrastructure layer for public and admin endpoints
â”‚      â”‚         â”œâ”€â”€ tracer
â”‚      â”‚         â””â”€â”€ web # HTTP clients to external services (partner's and stone's)
â”‚      â”œâ”€â”€ partners # adapter layer for the partner that provides the tag and transaction lifecycle services
â”‚      â””â”€â”€ worker # application's scheduled jobs
â”œâ”€â”€ cmd # main files for API and workers 
â”œâ”€â”€ deploy # deploy configuration for different environments
â””â”€â”€ docs # autogenerated swagger, postman collections to test partner's APIs
```

### Endpoints

* [LOCAL](http://localhost:3000/docs/v1/tolltag/swagger/index.html) (when the application is running locally)
* [HOMOLOG](http://inside-gateway.homolog.stone.credit/docs/v1/tolltag/swagger/index.html)
* [SANDBOX](http://inside-gateway.sandbox.stone.credit/docs/v1/tolltag/swagger/index.html)

### Domain

More detailed information on the entities and use cases, implementation decisions, etc., can be found below:

* [account](docs/account/README.md)
* [tag](docs/tag/README.md)
* [transaction](docs/transaction/README.md)
* [payment](docs/payment/README.md)

### Workers



## ğŸ¦¥ Good Practices

### Before committing

For the code to look shinny:

```bash
$ make pre-commit
```

When mocks and swagger documentation has changed:

```bash
$ make generate
```

## ğŸ“Š Monitoring

### New Relic

Dashboards can be found [here](https://one.newrelic.com/launcher/dashboards.launcher?platform[filters]=IihuYW1lIExJS0UgJ3RhZ2d5JyBPUiBpZCA9ICd0YWdneScgT1IgZG9tYWluSWQgPSAndGFnZ3knKSI=&platform[accountId]=2497233&platform[$isFallbackTimeRange]=false&pane=eyJuZXJkbGV0SWQiOiJkYXNoYm9hcmRzLmRldGFpbCIsInVzZURlZmF1bHRUaW1lUmFuZ2UiOmZhbHNlLCJzZWxlY3RlZFBhZ2UiOiJNalE1TnpJek0zeFdTVnA4UkVGVFNFSlBRVkpFZkRJeE1EQXhOVGMiLCJpc1RlbXBsYXRlRW1wdHkiOmZhbHNlLCJlbnRpdHlHdWlkIjoiTWpRNU56SXpNM3hXU1ZwOFJFRlRTRUpQUVZKRWZESXhNREF4TlRjIn0=&state=f7d2afa2-04e9-2572-8f95-e8a93764731c).

### Playbook

[TBD]
